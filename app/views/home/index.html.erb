<% if user_signed_in? %>
  <% if current_user.city == "" || current_user.zip_code == "" || current_user.address == "" %>
    <div class="container-md" style="padding-left: 25%; padding-right: 25%;">
      <h6 class="text-center mb-2">Completa il tuo profilo</h6>
      <%= form_for(:user, url: registration_path(:user), data: { turbo: false }, html: { method: :put }) do |f| %>
        <%= f.hidden_field :user_id, value: current_user.id %>
        <div class="form-floating mb-1">
          <%= f.text_field :first_name, class: "form-control", placeholder: "name@example.com", value: current_user.first_name, disabled: true %>
          <%= f.label :first_name %>
        </div>
        <div class="form-floating mb-1">
          <%= f.text_field :last_name, class: "form-control", placeholder: "name@example.com", value: current_user.last_name, disabled: true %>
          <%= f.label :last_name %>
        </div>
        <div class="form-floating mb-1">
          <%= f.email_field :email, class: "form-control", placeholder: "name@example.com", value: current_user.email, disabled: true %>
          <%= f.label :email %>
        </div>
        <div class="form-floating mb-1">
          <%= f.text_field :city, class: "form-control", placeholder: "password", value: current_user.city %>
          <%= f.label :city %>
        </div>
        <div class="form-floating mb-1">
          <%= f.text_field :zip_code, class: "form-control", placeholder: "password", value: current_user.zip_code %>
          <%= f.label :zip_code %>
        </div>
        <div class="form-floating mb-2">
          <%= f.text_field :address, class: "form-control", placeholder: "password", value: current_user.address %>
          <%= f.label :address %>
        </div>
        <%= f.submit "Continua", class: "modal-btn mx-auto p-2" %>
      <% end %>
    </div>
  <% end %>
<% end %>

<%# carousel section %>
<% if @latest_insertions %>
  <div class="container-md text-center">
    <div class="text-center mt-3">
      <span class="fw-bold">Ultime Novità</span>
    </div>

    <%# carousel %>
    <div id="carousel" class="carousel slide" data-bs-ride="carousel">
        <%# carousel content %>
        <div class="carousel-inner">
          <% @latest_insertions.each_with_index do |insertion, i| %>
            <% user = Seller.find(insertion.seller_id).user_id %>
            <div class="carousel-item <%= "active" if i == 0 %>">
              <%= link_to show_insertion_path(insertion) do %>
                <div class="carousel-container">
                  <%= image_tag(insertion.image, class: "carousel-image") %>
                  <div class="carousel-content">
                    <%= link_to user_profile_path(user) do %>
                      <span><%= User.full_name(user) %></span>
                    <% end %>
                    <h2 class="mb-0"><%= insertion.title %></h2>
                    <span> <%= sprintf('%.2f', insertion.price) %> €</span>
                    <div class="mt-3">
                      <%= link_to "Visualizza", show_insertion_path(insertion), class: "fw-bold btn btn-sm btn-primary" %>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>

        <%# carousel arrows %>
        <button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true">
            <i class="fa-solid fa-angle-left fa-2xl"></i>
          </span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true">
            <i class="fa-solid fa-angle-right fa-2xl"></i>
          </span>
          <span class="visually-hidden">Next</span>
        </button>
    </div>
  </div>
<% end %>

<%# insertion grid %>
<div class="">
  <div class="">
    <span class="fw-light">Categoria: 
    <% if params[:category] %>
      <%= params[:category] %>
    <% else %>
      -
    <% end %>
    </span>
    <h3 class="mb-0">Oggetti in vendita</h3>
  </div>
  <div class="row row-cols-4">
    <% @insertions.each do |insertion| %>
      <% if !insertion.sold %>      
        <div class="col mx-auto mb-4">
          <%= render "shared/insertion", insertion: insertion %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>