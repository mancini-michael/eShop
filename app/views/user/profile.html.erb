<div class="container-md">
  <div class="d-flex align-items-center justify-content-between my-5">
    <div class="d-flex align-items-center">
      <% if @user.provider == "local" %>
        <svg xmlns="http://www.w3.org/2000/svg" style="height: 150px; width: 150px;" class="position-relative" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd" />
        </svg>
      <% end %>
      <div>
        <% if Seller.find_by(user_id: @user) %>          
          <div class="mb-2">
            <h2 class="fw-bold">
              (<%= Seller.total_reviews(Seller.find_by(user_id: @user).id) %>) <%= Seller.average_rating(Seller.find_by(user_id: @user).id) %>
              <i class="fa-solid fa-star fa-2xs"></i>     
            </h2>
          </div>
        <% end %>
        <h5 class="mb-0"><%= @user.first_name %> <%= @user.last_name %></h5>
        <h6 class="mb-0"><%= @user.zip_code %>, <%= @user.city %></h6>
        <p class="fw-light fst-italic mb-1"><%= @user.email %></p>
        <% if user_signed_in? && current_user == @user %>        
          <%= link_to edit_user_registration_path do %>
            modifica
          <% end %>
        <% end %>
      </div>
    </div>
    <% if Seller.find_by(user_id: @user) %>   
      <div class="d-inline-flex">
        <% if !Seller.find_by(user_id: @user).active %>
          <span class="fw-bold">Venditore attualmente non attivo</span>
        <% else %>
          <% if user_signed_in? && current_user == @user %>
            <button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#insertion">
              <span class="btn btn-success">vendi</span>
            </button>
          <% else %>
            <span class="fw-bold">Venditore attivo</span>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<% if Seller.find_by(user_id: @user) %>
  <div class="container-md">
    <%= render "shared/create" %>
    <div class="d-flex justify-content-between align-items-center">
      <h3 class="mb-3">Annunci</h3>
      <%= link_to "#" do %>
        <span class="fw-bold">Visualizza tutti gli annunci</span>
      <% end %>
    </div>
    <div class="row row-cols-4 mb-5">
      <% @insertions.each do |item| %>
        <div class="col">
          <div class="card border-0 p-0">
            <%= link_to show_insertion_path(item) do %>
              <img src="https://a0.muscache.com/im/pictures/c0e10c8f-d0c3-4875-bae8-0f664a55bbc6.jpg?im_w=720" class="card-img-top img-fluid mb-2" alt="...">
              <div class="card-body lh-1 p-0">
                <div class="d-flex justify-content-between align-items-center">
                  <h6 class="card-title"><%= item.title %></h6>
                  <span class="fw-bold"><%= sprintf('%.2f', item.price) %> â‚¬</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-light"><%= Insertion.seller_name(item.seller_id) %></span>
                  <div class="rating d-inline-flex align-items-center">
                    <% if Seller.average_rating(item.seller_id) == 0 %>
                      <span class="fw-light">Nessuna recensione</span>
                    <% else%>
                      <span class="fw-bold">(<%= Seller.total_reviews(item.seller_id) %>) <%= Seller.average_rating(item.seller_id) %></span>
                      <i class="fa-solid fa-star fa-2xs"></i>          
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
            <% if user_signed_in? && current_user == @user %>              
              <div class="d-flex justify-content-evenly mt-3">
                <%= button_to destroy_insertion_path(item.id), method: :delete, class: "bg-transparent border-0" do %>
                  <span class="fw-bold">Elimina</span>
                <% end %>
                <button class="border-0 bg-transparent" data-bs-toggle="modal" data-bs-target="#edit<%= item.id %>">
                  <span class="fw-bold">Modifica</span>
                </button>
              </div>
              <%= render "shared/edit", insertion: item %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="mb-5">
      <div class="d-flex justify-content-between align-items-center">
        <h3 class="mb-3">Recensioni</h3>
        <% if user_signed_in? && current_user != @user %>
          <button class="border-0 bg-transparent" data-bs-toggle="modal" data-bs-target="#review">
            <span class="fw-bold">Valuta venditore</span>
          </button>
        <% end %>
      </div>
      <%= render "shared/review" %>
      <div class="row row-cols-4">
        <% @reviews.each do |item| %>
          <div class="col mx-auto">
            <div class="review-card">
              <%= link_to user_profile_path(item.user_id) do %>
                <h6 class="fw-bold"><%= User.find(item.user_id).first_name %> <%= User.find(item.user_id).last_name %></h6>
              <% end %>
              <span class="fw-bold my-1"><%= item.rating %></span>
              <div>
                <% (1..item.rating).each do %>
                  <i class="fa-solid fa-star fa-2xs"></i>              
                <% end %>
                <% (item.rating..4).each do %>
                  <i class="fa-regular fa-star fa-2xs"></i>              
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>   
<% end %>